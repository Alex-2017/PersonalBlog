<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.53" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>观察者模式 | Alex的博客</title>
    <meta property="og:title" content="观察者模式 - Alex的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2019-02-17T17:34:00&#43;08:00">
        
        
    <meta property="article:modified_time" content="2019-02-17T17:34:48&#43;08:00">
        
    <meta name="Keywords" content="Java,设计模式">
    <meta name="description" content="观察者模式">
        <meta name="author" content="Alex">
        
    <meta property="og:url" content="https://wangjc95.com/post/2-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/css/normalize.css">
    
        <link rel="stylesheet" href="/css/prism.css">
    
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

    


    
    
</head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://wangjc95.com">
                        Alex的博客
                    </a>
                
                <p class="description">Java程序猿</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://wangjc95.com">首页</a>
                    
                    <a  href="https://wangjc95.com/archives/" title="归档">归档</a>
                    
                    <a  href="https://wangjc95.com/about/" title="About">About</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">观察者模式</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2019年2月17日
                        </date>
                        
                        <div class="post-meta">
                            <span>|</span>
                            
                                <span class="meta-category"><a href="https://wangjc95.com/categories/java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">java设计模式</a></span>
                            
                        </div>
                        
                        
                        <div class="post-meta">
                            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span> 阅读</span></span>
                        </div>
                        
                        <div class="post-content">
                            

<p><strong>介绍:</strong> 这是阅读<code>head first design patterns</code>的阅读笔记.</p>

<h1 id="1-观察者模式">1.观察者模式</h1>

<h2 id="1-1定义">1.1定义</h2>

<p>观察者模式定义了对象之间的一对多依赖,这样一来,当一个对象改变状态时,它的所有依赖者都会收到通知并自动更新.</p>

<p><img src="https://raw.githubusercontent.com/Alex-2017/image-respository/master/img/20190217170741.png" alt="" /></p>

<h2 id="1-2设计原则">1.2设计原则</h2>

<p>为了交互对象之间的松耦合设计而努力.</p>

<h1 id="2-情景模拟">2.情景模拟</h1>

<h2 id="2-1情景介绍">2.1情景介绍</h2>

<p>建立一个天气推送应用,拉取气象站的最新数据(比如湿度,温度,气压等数据).并在显示装置中进行显示.<strong>显示装置会有多个.</strong></p>

<h2 id="2-2结构图">2.2结构图</h2>

<p><img src="https://raw.githubusercontent.com/Alex-2017/image-respository/master/img/20190217170639.png" alt="" /></p>

<h1 id="3-代码实现">3.代码实现</h1>

<h2 id="2-1代码类图">2.1代码类图</h2>

<p><img src="https://raw.githubusercontent.com/Alex-2017/image-respository/master/img/20190217170835.png" alt="" /></p>

<h2 id="2-2自定义搭建">2.2自定义搭建</h2>

<h3 id="2-2-1接口">2.2.1接口</h3>

<p><strong>Interface.java</strong></p>

<pre><code class="language-java">package observer.interfaces;
/**
 * @Author WangJiChao
 * @Date 2019/2/17 17:11
 * @Desc 存储所需接口类
 */
public class Interface {

    //主题接口,用于注册,添加和通知观察者
    public interface Subject {
        void registerObserver(Observer observer);
        void removeObserver(Observer observer);
        void notifyObserver();
    }

    //观察者接口,更新观察者中的数据
    public interface Observer{
        void update(float temp, float humidity, float pressure);
    }

    //公告板接口,展示观察者中的数据
    public interface DisplayElement{
        void display();
    }
}
</code></pre>

<h3 id="2-2-2主题对象">2.2.2主题对象</h3>

<p><strong>WeatherData.java</strong></p>

<pre><code class="language-java">package observer.subjects;

import observer.interfaces.Interface;
import java.util.ArrayList;

/**
 * @Author WangJiChao
 * @Date 2019/2/17 13:02
 * @Desc 实现Subject接口,存储实时的空气数据并告知给观察者.
 */
public class WeatherData implements Interface.Subject {
    //观察者列表
    private ArrayList&lt;Interface.Observer&gt; observers;
    private float temperature;
    private float humidity;
    private float pressure;

    public WeatherData() {
        observers = new ArrayList&lt;&gt;();
    }

    @Override
    public void registerObserver(Interface.Observer observer) {
        observers.add(observer);
    }

    @Override
    public void removeObserver(Interface.Observer observer) {
        int i = observers.indexOf(observer);
        if (i &gt;= 0) {
            observers.remove(i);
        }
    }

    @Override
    public void notifyObserver() {
        for (Interface.Observer observer : observers) {
            observer.update(temperature,humidity,pressure);
        }
    }

    public void measureChanged() {
        notifyObserver();
    }

    public void setMeasurements(float temperature,float humidity,float pressure) {
        this.temperature = temperature;
        this.humidity = humidity;
        this.pressure = pressure;
        measureChanged();
    }
}
</code></pre>

<h3 id="2-2-3观察者">2.2.3观察者</h3>

<p><strong>CurrentConditionDisplay.java</strong></p>

<pre><code class="language-java">package observer.subscribes;

import observer.interfaces.Interface;
/**
 * @Author WangJiChao
 * @Date 2019/2/17 13:04
 * @Desc 展示当前天气的观察者
 */
public class CurrentConditionDisplay implements Interface.Observer,Interface.DisplayElement {

    private Interface.Subject weatherData;
    private float temperature;
    private float humidity;

    public CurrentConditionDisplay(Interface.Subject weatherData) {
        //保存主题接口的引用
        this.weatherData = weatherData;
        //将其注册到主题借口中去
        weatherData.registerObserver(this);
    }

    @Override
    public void update(float temp, float humidity, float pressure) {
        this.temperature = temp;
        this.humidity = humidity;
        display();
    }

    @Override
    public void display() {
        System.out.println(String.format(&quot;CurrentCondition is %f temperatrue and %f humidity&quot;,temperature,humidity));
    }
}

</code></pre>

<p><strong>ForecastDisplay.java</strong></p>

<pre><code class="language-java">package observer.subscribes;

import observer.interfaces.Interface;
import observer.subjects.WeatherData;
/**
 * @Author WangJiChao
 * @Date 2019/2/17 16:13
 * @Desc 天气预测的观察者
 */
public class ForecastDisplay implements Interface.Observer,Interface.DisplayElement {
    private float currentPressure = 29.92f;
    private float lastPressure;
    private WeatherData weatherData;

    public ForecastDisplay(WeatherData weatherData) {
        this.weatherData = weatherData;
        weatherData.registerObserver(this);
    }

    @Override
    public void update(float temp, float humidity, float pressure) {
        lastPressure = currentPressure;
        currentPressure = pressure;
        display();
    }

    @Override
    public void display() {
        System.out.print(&quot;Forecast: &quot;);
        if (currentPressure &gt; lastPressure) {
            System.out.println(&quot;Improving weather on the way!&quot;);
        } else if (currentPressure == lastPressure) {
            System.out.println(&quot;More of the same&quot;);
        } else if (currentPressure &lt; lastPressure) {
            System.out.println(&quot;Watch out for cooler, rainy weather&quot;);
        }
    }
}

</code></pre>

<h3 id="2-2-4测试代码">2.2.4测试代码</h3>

<pre><code class="language-java"> //不使用Java自带的observer类模拟实现天气站数据的输送.
    @Test
    public void test1() {
        WeatherData weatherData = new WeatherData();
        CurrentConditionDisplay currentConditionDisplay = new CurrentConditionDisplay(weatherData);
        ForecastDisplay forecastDisplay = new ForecastDisplay(weatherData);
        weatherData.setMeasurements(1.1f,2.2f,3.3f);
        weatherData.setMeasurements(2,3,4.01f);
        weatherData.setMeasurements(12.12f,13,22.01f);
    }
</code></pre>

<p><strong>结果输出:</strong></p>

<pre><code>CurrentCondition is 1.100000 temperatrue and 2.200000 humidity
Forecast: Watch out for cooler, rainy weather
CurrentCondition is 2.000000 temperatrue and 3.000000 humidity
Forecast: Improving weather on the way!
CurrentCondition is 12.120000 temperatrue and 13.000000 humidity
Forecast: Improving weather on the way!
</code></pre>

<h2 id="2-3使用-java-内置类搭建">2.3使用<code>Java</code>内置类搭建</h2>

<h3 id="2-3-1主题对象">2.3.1主题对象</h3>

<p><strong>WeatherData.java</strong></p>

<pre><code class="language-java">package observer.observable;

import java.util.Observable;

//继承java内置的Observable类,不必再实现添加,删除,通知观察者等方法
public class WeatherData extends Observable {

    private float temperature;
    private float humidity;
    private float pressure;
    
    public WeatherData() {
    }

    public void measureChanged() {
        //设置父类Observable中的change为true,当change为true时才会通知观察者.
        setChanged();
        //通知观察者
        notifyObservers();
    }

    //获取最新数据并调用measureChanged方法
    public void setMeasurements(float temperature, float humidity, float pressure) {
        this.temperature = temperature;
        this.humidity = humidity;
        this.pressure = pressure;
        measureChanged();
    }

    public float getTemperature() {
        return temperature;
    }

    public float getHumidity() {
        return humidity;
    }

    public float getPressure() {
        return pressure;
    }
}

</code></pre>

<h3 id="2-3-2观察者">2.3.2观察者</h3>

<p><strong>CurrentConditionDisplay.java</strong></p>

<pre><code class="language-java">package observer.observable;

import observer.interfaces.Interface;

import java.util.Observable;
import java.util.Observer;

/**
 * @Author WangJiChao
 * @Date 2019/2/17 16:15
 * @Desc 实现java内置接口自定义当前天气观察者
 */
public class CurrentConditionDisplay implements Observer, Interface.DisplayElement {
    
    private float temperature;
    private float humidity;
    private float pressure;

    private Observable observable;

    //将Observable保存并将自身注册到Observable
    public CurrentConditionDisplay(Observable observable) {
        this.observable = observable;
        observable.addObserver(this);
    }

    //拉取所需数据并调用display方法
    @Override
    public void update(java.util.Observable o, Object arg) {
        if (o instanceof WeatherData) {
            WeatherData weatherData = (WeatherData) o;
            this.temperature = weatherData.getTemperature();
            this.humidity = weatherData.getHumidity();
            this.pressure = weatherData.getPressure();
            display();
        }
    }

    @Override
    public void display() {
        System.out.println(String.format(&quot;CurrentCondition is %f temperatrue and %f humidity&quot;, temperature, humidity));
    }
}

</code></pre>

<p><strong>ForecastDisplay.java</strong></p>

<pre><code class="language-java">package observer.observable;

import observer.interfaces.Interface;
import java.util.Observable;
import java.util.Observer;

/**
 * @Author WangJiChao
 * @Date 2019/2/17 16:15
 * @Desc 实现java内置接口自定义天气预测观察者
 */
public class ForecastDisplay implements Observer,Interface.DisplayElement{
    private float currentPressure = 29.92f;
    private float lastPressure;
    private WeatherData weatherData;

    public ForecastDisplay(WeatherData weatherData) {
        this.weatherData = weatherData;
        weatherData.addObserver(this);
    }

    @Override
    public void update(Observable o, Object arg) {
        if (o instanceof WeatherData) {
            WeatherData weatherData = (WeatherData) o;
            this.lastPressure = this.currentPressure;
            this.currentPressure = weatherData.getPressure();
            display();
        }
    }

    @Override
    public void display() {
        System.out.print(&quot;Forecast: &quot;);
        if (currentPressure &gt; lastPressure) {
            System.out.println(&quot;Improving weather on the way!&quot;);
        } else if (currentPressure == lastPressure) {
            System.out.println(&quot;More of the same&quot;);
        } else if (currentPressure &lt; lastPressure) {
            System.out.println(&quot;Watch out for cooler, rainy weather&quot;);
        }
    }
}


</code></pre>

<h3 id="2-3-3测试代码">2.3.3测试代码</h3>

<pre><code class="language-java">@Test
    public void test2() {
        observer.observable.WeatherData weatherData = new observer.observable.WeatherData();
        observer.observable.CurrentConditionDisplay currentConditionDisplay = new observer.observable.CurrentConditionDisplay(weatherData);
        observer.observable.ForecastDisplay forecastDisplay = new observer.observable.ForecastDisplay(weatherData);
        weatherData.setMeasurements(1.1f,2.2f,3.3f);
        weatherData.setMeasurements(2,3,4.01f);
        weatherData.setMeasurements(12.12f,13,22.01f);
    }

</code></pre>

<p><strong>结果输出:</strong></p>

<pre><code>Forecast: Watch out for cooler, rainy weather
CurrentCondition is 1.100000 temperatrue and 2.200000 humidity
Forecast: Improving weather on the way!
CurrentCondition is 2.000000 temperatrue and 3.000000 humidity
Forecast: Improving weather on the way!
CurrentCondition is 12.120000 temperatrue and 13.000000 humidity

</code></pre>

<h3 id="2-3-4-java-util-observable-的黑暗面">2.3.4<code>java.util.Observable</code>的黑暗面</h3>

<p>它是一个<strong>类</strong>而不是一个<strong>接口</strong>,导致了它的局限性.它不能被已经有父类的类继承.因为<code>java</code>不能多继承.</p>

                        </div>

                        


                        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/1-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/">策略模式</a></li>
        
        <li><a href="/about/">About</a></li>
        
        <li><a href="/archives/">博客</a></li>
        
    </ul>
</div>


                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="https://wangjc95.com/tags/head-first-design-patterns%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0">head first design patterns读书笔记</a></li>
                                
                            </ul>
                            
                        </div>
                    </article>
                    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "Alex-2017/comment"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        <form id="search" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://wangjc95.com">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://wangjc95.com/post/12-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/" title="状态模式">状态模式</a>
    </li>
    
    <li>
        <a href="https://wangjc95.com/post/11-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/" title="组合模式">组合模式</a>
    </li>
    
    <li>
        <a href="https://wangjc95.com/post/10-%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F/" title="迭代器模式">迭代器模式</a>
    </li>
    
    <li>
        <a href="https://wangjc95.com/post/9-%E6%A8%A1%E7%89%88%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F/" title="模版方法模式">模版方法模式</a>
    </li>
    
    <li>
        <a href="https://wangjc95.com/post/8-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/" title="外观模式">外观模式</a>
    </li>
    
    <li>
        <a href="https://wangjc95.com/post/7-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/" title="适配器模式">适配器模式</a>
    </li>
    
    <li>
        <a href="https://wangjc95.com/post/6-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/" title="命令模式">命令模式</a>
    </li>
    
    <li>
        <a href="https://wangjc95.com/post/5-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" title="单例模式">单例模式</a>
    </li>
    
    <li>
        <a href="https://wangjc95.com/post/4-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" title="工厂模式">工厂模式</a>
    </li>
    
    <li>
        <a href="https://wangjc95.com/post/3-%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/" title="装饰者模式">装饰者模式</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://wangjc95.com/categories/java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">java设计模式(12)</a>
    </li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="https://wangjc95.com/tags/head-first-design-patterns%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">head-first-design-patterns读书笔记</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://wangjc95.com/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
        &copy; 2019 <a href="https://wangjc95.com">Alex的博客 By Alex</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/rujews/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    <script type="text/javascript">
    
    (function(){
        $("pre code").parent().addClass("line-numbers")
    }())

    window.MathJax = {
        tex2jax: {
            inlineMath: [ ['$','$'] ],
            processEscapes: true
        }
    };
    </script>
    <script type="text/javascript" src="/js/prism.js" async="true"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src="/js/totop.js?v=0.0.0" async=""></script>



<script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>
</html>
